@using IlmAcademy.ViewModels
@model PagesViewModel

@* <div class="site-wrapper-reveal">
    <div class="breadcrumb-area" style="background:url(/assets/images/slidebg3.jpg) no-repeat center; background-size:cover; z-index:2">
        <div class="slider-mask"></div>
        <div class="container">
            <div class="row">
                <div class="col-12 text-center text-white py-5">
                    <h1 class="breadcrumb-title"> Application Submitted</h1>
                    <p class="fs-5 mb-0">
                        Congratulations <b>@Model.StudentApplication.StudentName</b>!
                        Your application has been received successfully.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="container mt-5 mb-5">
    <div class="card shadow-lg border-0 rounded-4">
            <div class="card-header text-white text-center py-3 rounded-top-4" style="background:rgb(20 37 63)">
            <h4 class="mb-0 text-white">Application Confirmation</h4>
            <small>Your details have been successfully submitted</small>
        </div>

        <div class="card-body p-4">

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Student Name:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.StudentName</div>
                </div>
                <div class="col-md-6">
                    <strong>Father Name:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.FatherName</div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Phone:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.PhoneNo</div>
                </div>
                <div class="col-md-6">
                    <strong>Father Email:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.FatherEmail</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>DateOfBirth:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.DateOfBirth</div>
                </div>
                <div class="col-md-6">
                        <strong>Registration Number:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.RegistrationNumber</div>
                </div>
            </div>
            <div class="row mb-3">
              
                <div class="col-md-6">
                        <strong>Registration Number:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.RegistrationNumber</div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Father Mobile Number:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.FatherMobileNumber</div>
                </div>
                <div class="col-md-6">
                        <strong>Registration Number:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.RegistrationNumber</div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Age:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.Age</div>
                </div>
                <div class="col-md-6">
                    <strong>Student Photo:</strong>
                    <div class="border rounded-3 p-2 bg-light text-center">
                        <img src="~/uploads/@Model.StudentApplication.Photo.FileName"
                             alt="Student Photo"
                             class="img-thumbnail mt-1"
                             width="120" />
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>CNIC:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.StudentNic</div>
                </div>
                <div class="col-md-6">
                    <strong>Email:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.Email</div>
                </div>
              
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Department:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.Department</div>
                </div>
                <div class="col-md-6">
                    <strong>Designation:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.Designation</div>
                </div>
            </div>

           

            <div class="row mb-3">
                <div class="col-md-12">
                    <strong>Description:</strong>
                    <div class="border rounded-3 p-2 bg-light">@Model.StudentApplication.Description</div>
                </div>
            </div>
                <div class="col-lg-auto text-end mt-4">
                    <button type="submit" id="submitBtn" class="btn px-5 py-2 rounded-3 shadow" style="background:rgb(20 37 63)">
                        Confirm & Submit
                    </button>
                </div>
        </div>
    </div>
    </div>
    
</div> *@
<div class="site-wrapper-reveal">
    <div class="breadcrumb-area" style="background:url(/assets/images/slidebg3.jpg) no-repeat top; background-size:cover; z-index:2; padding-top:45px">
        <div class="slider-mask">
        </div>

    </div>
    <section class="pt-lg-5  pt-4  pb-4 pb-lg-5  ">

        <div class="container pt-lg-4 ">
            <div class="row position-relative g-4">
                <div class="col-lg-12 m-auto">
                    <div class=" text-center">

                        <h1 class="text-body">
                            Application Confirmation
                        </h1>
                    </div>
                </div>
                <div class="clearfix"></div>
               @*  <div class="col-12 ">
                    <div class="table-responsive  p-4 card" style="border-color:#0d4faf">
                        <h5 class="mb-2 fw-semibold">Application Selection</h5>
                        <table class="table personal mb-0 personal-information  table-borderless">
                            <tbody>
                                <tr>
                                    <td>Campus : <span class="fw-bold"> Dubai - Al Nahda</span></td>
                                    <td>Session :  <span class="fw-bold">August 2025</span></td>
                                    <td>Program : <span class="fw-bold"> Diploma in Web Development</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
 *@
                <div class="col-12 ">
                    <div class="table-responsive  p-4 card" style="border-color:#0d4faf">
                        <h5 class="mb-2 fw-semibold">Personal Information</h5>
                        <table class="table personal mb-0 personal-information  table-borderless">
                            <tbody>
                                <tr>
                                    <td>Student Name:<span class="fw-bold">@Model.StudentApplication.StudentName</span></td>
                                    <td>Email : <span class="fw-bold"> @Model.StudentApplication.Email</span></td>
                                    <td>Mobile No. <span class="fw-bold"> : @Model.StudentApplication.PhoneNo</span></td>
                                </tr>
                                <tr>
                                    <td>Registration No: <span class="fw-bold"> @Model.StudentApplication.RegistrationNumber</span></td>
                                </tr>
                                <tr>
                                    <td>DateOfBirth : <span class="fw-bold"> @Model.StudentApplication.DateOfBirth</span></td>
                                    <td>Age: <span class="fw-bold"> @Model.StudentApplication.Age</span></td>
                                    
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Family Information -->
                <div class="col-12 ">
                    <div class="table-responsive  p-4 card" style="border-color:#0d4faf">
                        <h5 class="mb-2 fw-semibold">Family Information</h5>
                        <table class="table personal mb-0 personal-information  table-borderless">
                            <tbody>
                                <tr>
                                    <td>Father Name: <span class="fw-bold"> @Model.StudentApplication.FatherName</span></td>
                                    <td>Father CNIC : <span class="fw-bold"> @Model.StudentApplication.FatherNic</span></td>
                                    <td>Father Mobile : <span class="fw-bold"> @Model.StudentApplication.FatherMobileNumber</span></td>
                                </tr>
                                <tr>
                                    <td>Father Passport: <span class="fw-bold"> B98765432</span></td>
                                    <td>Father Email : <span class="fw-bold"> @Model.StudentApplication.FatherEmail</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Education Information -->
                 <div class="col-12 ">
                    <div class="table-responsive  p-4 card" style="border-color:#0d4faf">
                        <h5 class="mb-2 fw-semibold">Education Information</h5>
                        <table class="table personal mb-0 personal-information  table-borderless">
                            <tbody>
                                <tr>
                                    <td>Category Name: <span class="fw-bold"> @Model.StudentApplication.StudentCategoryId</span></td>
                                    <td>Description: <span class="fw-bold">@Model.StudentApplication.Description</span></td>

                                </tr>
                               
                            </tbody>
                        </table>
                    </div>
                </div>
 
                <!-- Additional Documents -->
             @*    <div class="col-12 ">
                    <div class="table-responsive  p-4 card" style="border-color:#0d4faf">
                        <h5 class="mb-2 fw-semibold">Additional Documents</h5>
                        <table class="table personal mb-0 personal-information  table-borderless">
                            <tbody>
                                <tr>
                                    <td>
                                        <label>Student Profile Photo</label>
                                        <figure>
                                            @if (Model.StudentApplication.PhotoBytes != null)
                                            {
                                                <div class="text-center">
                                                    <img src="data:image/png;base64,@Convert.ToBase64String(Model.StudentApplication.PhotoBytes)"
                                                         class="img-thumbnail" style="max-width:200px;" />

                                                    <!-- Hidden input for sending base64 -->
                                                    <input type="hidden" id="PhotoBase64"
                                                           value="@Convert.ToBase64String(Model.StudentApplication.PhotoBytes)" />
                                                </div>
                                            }
                                        </figure>

                                    </td>
                                    
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
 *@
                <div class="col-lg-12 col-md-12 col-sm-12 d-md-flex justify-content-between align-items-center">
                    <button id="submitBtn" type="submit" class="btn btn-sm btn--secondary ht-btn-sm w-auto">Submit Application</button>


                    <a class="btn btn--white ht-btn-sm" href="/dashboard" style="font-size:12px; white-space:nowrap"><i class="fa-solid fa-arrow-left"></i> Dashboard</a>
                </div>

            </div>
        </div>
        <input type="hidden" id="StudentProfileId" name="StudentApplication.StudentProfileId" value="@Model.StudentApplication.StudentProfileId" />
        <input type="hidden" id="StudentName" name="StudentApplication.StudentName" value="@Model.StudentApplication.StudentName" />
        <input type="hidden" id="FatherName" name="StudentApplication.FatherName" value="@Model.StudentApplication.FatherName" />
        <input type="hidden" id="PhoneNo" name="StudentApplication.PhoneNo" value="@Model.StudentApplication.PhoneNo" />
        <input type="hidden" id="Description" name="StudentApplication.Description" value="@Model.StudentApplication.Description" />
        <input type="hidden" id="StudentCategoryId" name="StudentApplication.StudentCategoryId" value="@Model.StudentApplication.StudentCategoryId" />
        <input type="hidden" id="StudentNic" name="StudentApplication.StudentNic" value="@Model.StudentApplication.StudentNic" />
        <input type="hidden" id="FatherEmail" name="StudentApplication.FatherEmail" value="@Model.StudentApplication.FatherEmail" />
        <input type="hidden" id="RegistrationNumber" name="StudentApplication.RegistrationNumber" value="@Model.StudentApplication.RegistrationNumber" />
        <input type="hidden" id="Department" name="StudentApplication.Department" value="@Model.StudentApplication.Department" />
        <input type="hidden" id="Designation" name="StudentApplication.Designation" value="@Model.StudentApplication.Designation" />
        <input type="hidden" id="DateOfBirth" name="StudentApplication.DateOfBirth" value="@Model.StudentApplication.DateOfBirth" />
        <input type="hidden" id="Email" name="StudentApplication.Email" value="@Model.StudentApplication.Email" />
        <input type="hidden" id="FatherMobileNumber" name="StudentApplication.FatherMobileNumber" value="@Model.StudentApplication.FatherMobileNumber" />
        <input type="hidden" id="FatherNic" name="StudentApplication.FatherNic" value="@Model.StudentApplication.FatherNic" />
        <input type="hidden" id="Age" name="StudentApplication.Age" value="@Model.StudentApplication.Age" />

    </section>
    <script src="/assets/js/vendor/jquery-3.5.1.min.js"></script>
    <script>
        jQuery(document).ready(function () {
            ImgUpload();
        });

        function ImgUpload() {
            var imgWrap = "";
            var imgArray = [];

            $('.upload__inputfile').each(function () {
                $(this).on('change', function (e) {
                    imgWrap = $(this).closest('.upload__box').find('.upload__img-wrap');
                    var maxLength = $(this).attr('data-max_length');

                    var files = e.target.files;
                    var filesArr = Array.prototype.slice.call(files);
                    var iterator = 0;
                    filesArr.forEach(function (f, index) {

                        if (!f.type.match('image.*')) {
                            return;
                        }

                        if (imgArray.length > maxLength) {
                            return false
                        } else {
                            var len = 0;
                            for (var i = 0; i < imgArray.length; i++) {
                                if (imgArray[i] !== undefined) {
                                    len++;
                                }
                            }
                            if (len > maxLength) {
                                return false;
                            } else {
                                imgArray.push(f);

                                var reader = new FileReader();
                                reader.onload = function (e) {
                                    var html = "<div class='upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close'></div></div></div>";
                                    imgWrap.append(html);
                                    iterator++;
                                }
                                reader.readAsDataURL(f);
                            }
                        }
                    });
                });
            });

            $('body').on('click', ".upload__img-close", function (e) {
                var file = $(this).parent().data("file");
                for (var i = 0; i < imgArray.length; i++) {
                    if (imgArray[i].name === file) {
                        imgArray.splice(i, 1);
                        break;
                    }
                }
                $(this).parent().parent().remove();
            });
        }
    </script>
    </div>
<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4 text-center">
            <h4 class="mb-2 text-success">✅ Application Submitted</h4>
            <p class="mb-3">Your application has been submitted successfully.<br>We’ll contact you soon.</p>
            <button id="okBtn" class="btn btn-primary">OK</button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
       $("#submitBtn").click(async function(e){
        e.preventDefault();
         var formData = new FormData();
    formData.append("StudentName", $("#StudentName").val());
    formData.append("FatherName", $("#FatherName").val());
    formData.append("PhoneNo", $("#PhoneNo").val());
    formData.append("Description", $("#Description").val());
    formData.append("Email", $("#Email").val());
    formData.append("StudentCategoryId", $("#StudentCategoryId").val());
    formData.append("StudentNic", $("#StudentNic").val());
    formData.append("FatherEmail", $("#FatherEmail").val());
    formData.append("RegistrationNumber", $("#RegistrationNumber").val());
    formData.append("Department", $("#Department").val());
    formData.append("Designation", $("#Designation").val());
    formData.append("DateOfBirth", $("#DateOfBirth").val());
    formData.append("FatherMobileNumber", $("#FatherMobileNumber").val());
    formData.append("FatherNic", $("#FatherNic").val());
    formData.append("Age", $("#Age").val());

    

        $.ajax({
            url: '/insert-profile-data',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response){
                  $("#successModal").modal("show");
            },
            error: function(err){
                console.error(err);
            }
        });
    });
        $(document).on("click", "#okBtn", function(){
        window.location.href = "/application-submited-success"; 
    });
</script>